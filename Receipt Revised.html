<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/> 
    <title>Receipt 2.0</title>
	<style type="text/css">
		/* HTML */
		html,body {
			margin: 0px;
			width: 100%;
		}     
        table { 
			border: none;
			border-collapse: collapse;
			width: 100%;
        }        
		img {
			max-width: 100%;
		}
		p {
			margin: 0px;
		}

		/* Classes */
		.floatLeft {
			float: left;
		}
		.floatRight {
			float: right;
		}
		.borderTop {
			border-top: 1px solid black;
		}
		.borderBottom {
			border-bottom: 1px solid black;
		}
		.alignLeft {
			text-align: left;
		}
		.alignRight {
			text-align: right;
		}
		.alignCenter {
			text-align: center;
		}
		.fontWeightNormal {
			font-weight: normal;
		}
		.widthHundred {
			width: 100%;
		}
		.widthSixty {
			width: 60%;
		}
		.widthTen {
			width: 10%;
		}
        .marginClearRight {
			clear: right;
		}
		.marginClearLeft {
			clear:left;
		}
		.clearBoth {
			clear: both;
		}
		.hideItem {
			display: none;
		}
		
    	/* IDs */
		#promotionText {
			display: inline-block;
			width: 80%;
			margin-bottom: 5px !important;	
		}
		#promotionTextThin {
			display:inline-block;
			width: 80%;
			border: thin solid black;
			margin-bottom: 5px !important;	
		}
		#promotionTextMedium {
			display:inline-block;
			width: 80%;
			border: medium solid black;
			margin-bottom: 5px !important;	
		}
		#promotionTextThick {
			display:inline-block;
			width: 80%;
			border: thick solid black;
			margin-bottom: 5px !important;	
		}
		#restaurantInfo {
			margin: 5px;
		}
		#takeAwayInfo {
			display: inline-block;
			width: 100%;
			margin: 5px;
		}
		#qrCode {
			margin: 10px;
		}
		#centeredCompanyInfo {
			width: 600px;
			margin-left: auto;
			margin-right: auto;
		}
		#signature {
			margin-bottom: 10px;
		}
	</style>
	<script type="text/javascript" src="http://www.posios.com/js/jquery.min.js"></script>
	<script type="text/javascript" src="http://www.posios.com/js/jquery.tmpl.min.js"></script>
	<script type="text/javascript" src="http://www.posios.com/js/jquery.qrcode.min.js"></script>
	<script type="text/javascript" src="http://www.posios.com/js/moment.min.js"></script>
	<script type="text/javascript">      
		(function(){
			Array.prototype.allIndexOf = function(searchElement) {
				if (this === null) { return [-1]; }
				var len = this.length,
				hasIndexOf = Array.prototype.indexOf,
				i = (hasIndexOf) ? this.indexOf(searchElement) : 0, n, indx = 0, result = [];
				if (len === 0 || i === -1) { return [-1]; }
				if (hasIndexOf) {
					for (n = 0; n <= len; n++) {
						i = this.indexOf(searchElement, indx);
					if (i !== -1) {
						indx = i + 1;
						result.push(i);
					} else {
						return result;
					}
				}
				return result;
				} else {
					for (n = 0; n <= len; n++) {
						if (this[n] === searchElement) {
							result.push(n);
						}
					}
					return (result.length > 0) ? result : [-1];
				}
			};
		})();

		function isDineIn(receiptType) {
			if(receiptType.toUpperCase() == "RESTAURANT" || receiptType.toUpperCase() == "BAR")
				return true;
			return false;
		}

		function checkIfNotZeroEmptyOrNull(passedValue) {
			if(typeof passedValue !== "undefined") {
				if(!passedValue)
					return false;
				else
					if(passedValue === "" || passedValue.length == 0)
						return false;
					else
						return true;
			}
		}

		function calculateAdditionsPrices(additions, option) {
			var total = 0;

			for(var key in additions) {
				if(additions.hasOwnProperty(key)) {
					// Option added for menus.
					if(option == 2)
						total += additions[key].price;
					else
						total += additions[key].price * additions[key].amount;
				}
			}

			return total;
		}

		function productIsOffert(productName) {
			if(productName.indexOf('*') > -1)
				return true;
			return false;
		}

		// Option 1: Belgian date and time dd/mm/yyyy hh:mm
		// Option 2: Belgian date          dd/mm/yyyy
		// Option 3: UK/US date and time   mm/dd/yyyy hh:mm AM/PM
		// Option 4: UK/US date            mm/dd/yyyy
		function dateToString(passedDate, option) {
			var meridiem = 'AM';
			if(passedDate)
				var date = new Date(passedDate);
			else
				var date = new Date();
			var dd = date.getDate();
			var mm = date.getMonth() + 1;
			var hh = date.getHours();
			var m = date.getMinutes();
			if(dd < 9)
				dd = '0' + dd;
			if(mm < 9)
				mm = '0' + mm;
			if(hh > 12 && option == 3)
				hh = hh - 12;
			if(hh == 12 && option == 3)
				meridiem = 'PM';
			if(hh < 10)
				hh = '0' + hh;
			if(m < 10)
				m = '0' + m;
			var stringTime = '';
			switch(option) {
				case 1: stringTime = dd + '/' + mm + '/' + date.getFullYear() + ' ' + hh + ":" + m;
						break;
				case 2: stringTime = dd + '/' + mm + '/' + date.getFullYear();
						break;
				case 3: stringTime = mm + '/' + dd + '/' + date.getFullYear() + ' ' + hh + ":" + m + ' ' + meridiem;
						break;
				case 4: stringTime = mm + '/' + dd + '/' + date.getFullYear();
						break;
			}
			return stringTime;
		}

		function getPayment(payments) {
			var totalPayment = 0;
				
			if(!payments) {
				return 0;
			}
				
			for (var pIndex in payments) {
				if(payments.hasOwnProperty(pIndex)) {
					var payment = payments[pIndex];
					
					if(payment) 
						totalPayment += payment.amount;
				}
			}		
			return totalPayment;	
		}

		function markUpName(passedName) {
			return passedName[0].toUpperCase() + passedName.substring(1);
		}

		function sortJsonArrayByProperty(objArray, prop, direction){
			if (arguments.length<2) throw new Error("sortJsonArrayByProp requires 2 arguments");
			var direct = arguments.length>2 ? arguments[2] : 1; //Default to ascending
			var intRegex = /^\d+$/;

			if(objArray) {
				var propPath = (prop.constructor===Array) ? prop : prop.split(".");
				objArray.sort(function(a,b){
					for (var p in propPath){
						if (a[propPath[p]] && b[propPath[p]]){
							a = a[propPath[p]];
							b = b[propPath[p]];
						}
					}

					if(!(intRegex.test(a) && intRegex.test(b))) {
						// convert numeric strings to integers
						a = a.match(/^\d+$/) ? +a : a;
						b = b.match(/^\d+$/) ? +b : b;
					}
					return ( (a < b) ? -1*direct : ((a > b) ? 1*direct : 0) );
				});
			}
		}

		function dynamicSort(property) {
			var sortOrder = 1;
			if(property[0] === "-") {
				sortOrder = -1;
				property = property.substr(1);
			}
			return function (a,b) {
				var result = (a[property] < b[property]) ? -1 : (a[property] > b[property]) ? 1 : 0;
				return result * sortOrder;
		    }
		}

		var sort_by;

		(function() {
			// utility functions
			var default_cmp = function(a, b) {
				if (a == b) return 0;
				return a < b ? -1 : 1;
			},
			getCmpFunc = function(primer, reverse) {
				var dfc = default_cmp, // closer in scope
				cmp = default_cmp;
				if (primer) {
					cmp = function(a, b) {
						return dfc(primer(a), primer(b));
					};
				}
				if (reverse) {
					return function(a, b) {
						return -1 * cmp(a, b);
					};
				}
				return cmp;
			};

			// actual implementation
			sort_by = function() {
				var fields = [], n_fields = arguments.length, field, name, reverse, cmp;

				// preprocess sorting options
				for (var i = 0; i < n_fields; i++) {
					field = arguments[i];
					if (typeof field === 'string') {
						name = field;
						cmp = default_cmp;
					}
					else {
						name = field.name;
						cmp = getCmpFunc(field.primer, field.reverse);
					}
					fields.push({
						name: name,
						cmp: cmp
					});
				}

				// final comparison function
				return function(A, B) {
					var a, b, name, result;
					for (var i = 0; i < n_fields; i++) {
						result = 0;
						field = fields[i];
						name = field.name;

						result = field.cmp(A[name], B[name]);
						if (result !== 0) break;
					}
					return result;
				}
			}
		}());

		function checkLine() {
			if(window.posEnableSortOnCourseThenOnKitchenName == 1) {
				var table = document.getElementById("receiptItemsList");
				for (var i = 0, row; row = table.rows[i]; i++) {
				   if(row.cells[0].innerHTML == 1)
				      row.className = "borderTop";
				}
			}
		}

		function calculateTip(payments) {
			var totalTip = 0;
				
			if(!payments)
				return 0;	
				
			for (var pIndex in payments) {
				if(payments.hasOwnProperty(pIndex)) {
			  		var payment = payments[pIndex];
							
					if(payment) 
				  		totalTip += payment.tips;
				}
			}			
			return totalTip;
		}

		function flattenReceiptItemsHierarchy(items) {
			if(!checkIfNotZeroEmptyOrNull(items))
				return null;
			else {
				var res = new Array();
				addReceiptItemsWithParentTo(items, 0, res);
				// add orphaned items (shouldn't happen!)
				if(items.length != res.length) {
					for(var item in items)
						if(items.hasOwnProperty(item))
							if(!res.indexOf(items[item]) > 1)
								res[res.length] = items[item];
				}
				return res;
			}
		}

		function addReceiptItemsWithParentTo(items, parentRiReceiptId, res) {
			for(var item in items) {
				if(items.hasOwnProperty(item)) {
					if(items[item].parentRiReceiptId == parentRiReceiptId) {
						var counter = 1, encountered = 0;
						if(res.length != 0 && items[item].parentRiReceiptId != 0 && items[item].priceTypeId != 11 && items[item].priceTypeId != 12) {
							while(res.length - counter >= 0 && encountered == 0) {
								var foundRoot = 0, branchParent = -1;
								while(res.length - counter >= 0 && foundRoot == 0) {
									if(parentRiReceiptId == res[res.length - counter].riReceiptId) {
										res[res.length - counter].price += items[item].price + calculateAdditionsPrices(items[item].additionValues, 2);
										branchParent = res[res.length - counter].parentRiReceiptId;
										counter++;
									}
									while(branchParent != 0 && res[res.length - counter].riReceiptId == branchParent) {
										res[res.length - counter].price += items[item].price + calculateAdditionsPrices(items[item].additionValues, 2);
										branchParent = res[res.length - counter].parentRiReceiptId;
										counter++;
									}
									if(branchParent == 0)
										foundRoot = 1;
									counter++;
								}
							}
						}
						res[res.length] = items[item];
						if(items[item].riReceiptId != 0)
							addReceiptItemsWithParentTo(items, items[item].riReceiptId, res);
					}
				}
			}
		}

		// Need to be globally accessible for sorting
		var itemArray, combinedMenuArray;

		function combineMenusAndItems(receiptItems) {
			var receiptItemsToArray = new Array(), combinedArray = new Array();

			if(!checkIfNotZeroEmptyOrNull(receiptItems))
				return receiptItemsToArray;

			// Store all receipt items in an array
			for(var receiptItem in receiptItems)
				if(receiptItems.hasOwnProperty(receiptItem))
					receiptItemsToArray.push(receiptItems[receiptItem]);

			var menuItemArray = new Array(), itemArray = new Array();

			// Go over the different receipt items and divide menus from regular items
			for(var i = 0; i < receiptItemsToArray.length; i++) {
				if(checkIfMenu(receiptItemsToArray[i]) || checkMenuItem(receiptItemsToArray[i]))
					menuItemArray.push(receiptItemsToArray[i]);
				else
					itemArray.push(receiptItemsToArray[i]);
			}

			// Combine regular items
			itemArray = combineItems(itemArray);

			// Split up the menu's
			var menuArray = new Array(), counter = -1;

			for(var i = 0; i < menuItemArray.length; i++) {
				if(checkIfMenu(menuItemArray[i]) && menuItemArray[i].parentRiReceiptId == 0) {
					counter++;
					menuArray[counter] = new Array();
					menuArray[counter].push(menuItemArray[i]);
				}
				else
					menuArray[counter].push(menuItemArray[i]);
			}

			// Now the tough job, combining menu's
			var storedMenu = new Array(), storedMenuDetails = new Array(), combinedMenuArray = new Array(), counter = 0;

			for(var j = 0; j < menuArray.length; j++) {
				if(j == 0) {
					storedMenu[0] = new Array();
					storedMenu[0].push(menuArray[0]);
					combinedMenuArray[0] = new Array();
					combinedMenuArray[0].push(menuArray[0]);
					storedMenuDetails[0] = new Array();
					storedMenuDetails[0].push(menuArray[0][0].name);
					storedMenuDetails[0].push(menuArray[0].length);
					storedMenuDetails[0].push(menuArray[0][0].price);
					storedMenuDetails[0].push(getBranchNames(menuArray[0]));
					counter++;
				}
				else {
					var index = menuDetailsPresent(menuArray[j], storedMenuDetails);
					if(index != -1) {
						var flag = 0;
						for(var i = 0; i < index.length; i++) {
							if(checkIfMenuIsSame(menuArray[j], storedMenu[index[i]])) {
								for(var h = 0; h < menuArray[index[i]].length; h++)
									combinedMenuArray[index[i]][0][h].amount += menuArray[j][h].amount;
								flag++;
							}
						}
						if(flag == 0) {
							storedMenu[counter] = new Array();
							storedMenu[counter].push(menuArray[j]);
							combinedMenuArray[counter] = new Array();
							combinedMenuArray[counter].push(menuArray[j]);
							storedMenuDetails[counter] = new Array();
							storedMenuDetails[counter].push(menuArray[j][0].name);
							storedMenuDetails[counter].push(menuArray[j].length);
							storedMenuDetails[counter].push(menuArray[j][0].price);
							storedMenuDetails[counter].push(getBranchNames(menuArray[j]));
							counter++;
						}
					}
					else {
						storedMenu[counter] = new Array();
						storedMenu[counter].push(menuArray[j]);
						combinedMenuArray[counter] = new Array();
						combinedMenuArray[counter].push(menuArray[j]);
						storedMenuDetails[counter] = new Array();
						storedMenuDetails[counter].push(menuArray[j][0].name);
						storedMenuDetails[counter].push(menuArray[j].length);
						storedMenuDetails[counter].push(menuArray[j][0].price);
						storedMenuDetails[counter].push(getBranchNames(menuArray[j]));
						counter++;
					}
				}
			}

			for(var j = 0; j < itemArray.length; j++)
				combinedArray.push(itemArray[j]);
			for(var j = 0; j < combinedMenuArray.length; j++)
				for(h = 0; h < combinedMenuArray[j][0].length; h++)
					combinedArray.push(combinedMenuArray[j][0][h]);

			// We made it!
			return combinedArray;
		}

		function checkIfMenu(item) {
			if(item.priceTypeId == 11 || item.priceTypeId == 12)
				return true;
			return false;
		}

		function checkMenuItem(item) {
			if(item.priceTypeId != 11 && item.priceTypeId != 12 && item.parentRiReceiptId != 0)
				return true;
			return false;
		}

		function getBranchNames(menu) {
			var branchNames = new Array();

			for(var i = 0; i < menu.length; i++)
				if((menu[i].priceTypeId == 11 || menu[i].priceTypeId == 12) && menu[i].parentRiReceiptId != 0)
					branchNames.push(menu[i].name);

			return branchNames.sort();
		}

		function menuDetailsPresent(menu, storedMenuDetails) {
			var name = menu[0].name;
			var length = menu.length;
			var price = menu[0].price;
			var branchNames = getBranchNames(menu);
			var index = new Array();
			
			for(var i = 0; i < storedMenuDetails.length; i++) {
				if(storedMenuDetails[i][0] === name && storedMenuDetails[i][1] == length && storedMenuDetails[i][2] == price && storedMenuDetails[i][3].length == branchNames.length) {
					for(var j = 0; j < branchNames.length; j++) {
						if(!branchNames[j] === storedMenuDetails[i][j])
							break;
					}
					index.push(i);
				}
			}

			return index.length > 0 ? index : -1;
		}

		function checkIfMenuIsSame(menu, storedMenu) {
			if(menu.length == storedMenu[0].length) {
				for(var i = 0; i < menu.length; i++) {
					if(!isSameProduct(menu[i], storedMenu[0][i]))
						return false;
				}
			}
			else {
				return false;
			}
			return true;
		}

		function combineItems(receiptItems) {
			var receiptItemsToArray = new Array();

			// Store all receipt items in an array
			for(var receiptItem in receiptItems)
				if(receiptItems.hasOwnProperty(receiptItem))
					receiptItemsToArray.push(receiptItems[receiptItem]);

			var combinedArray = new Array(), checkedIds = new Array();

			// Go over the different receipt items
			for(var i = 0; i < receiptItemsToArray.length; i++) {
				// Store first item
				if(i == 0) {
					combinedArray.push(receiptItemsToArray[i]);
					checkedIds.push(receiptItemsToArray[i].pOid);
				}
				else if(receiptItemsToArray[i].priceTypeId == 11 || receiptItemsToArray[i].priceTypeId == 12 || receiptItemsToArray[i].parentRiReceiptId != 0) {
					combinedArray.push(receiptItemsToArray[i]);			
				}
				else {
					// Check if pOid has already been added to combinedArray
					var foundIndex = checkedIds.allIndexOf(receiptItemsToArray[i].pOid);
					if(foundIndex < 0) {
						// The pOid has not been added yet
						combinedArray.push(receiptItemsToArray[i]);
						checkedIds.push(receiptItemsToArray[i].pOid);				
					}
					else if(foundIndex.length > 1) {
						var flag = 0;
						// Check each index to check if the product has the same details as the one stored
						for(var index = 0; index < foundIndex.length; index++) {
							// Check if the product has the same details as the one stored
							if(isSameProduct(combinedArray[foundIndex[index]], receiptItemsToArray[i])) {
								combinedArray[foundIndex[index]].amount += receiptItemsToArray[i].amount;
								flag++;
							}				
						}
						if(flag < 1) {
							combinedArray.push(receiptItemsToArray[i]);
							checkedIds.push(receiptItemsToArray[i].pOid);
						}
						else if(flag > 1) {
							console.log("Something went wrong here. This is not possible.");
						}

					}
					else {
						// Check if the product has the same details as the one stored
						if(isSameProduct(combinedArray[foundIndex], receiptItemsToArray[i])) {
							combinedArray[foundIndex].amount += receiptItemsToArray[i].amount;
						}
						else {
							combinedArray.push(receiptItemsToArray[i]);
							checkedIds.push(receiptItemsToArray[i].pOid);				
						}
					}
				}
			}

			var correctArray = new Array();
			
			for(var key in combinedArray)
				if(combinedArray.hasOwnProperty(key))
					if(combinedArray[key].amount != 0)
						correctArray.push(combinedArray[key]);
			return correctArray;
		}

		function isSameProduct(storedReceiptItem, newReceiptItem) {
			if(storedReceiptItem.name === newReceiptItem.name) {
				// Check if unit price is the same
				if(storedReceiptItem.price == newReceiptItem.price) {
					// Check if the additions are the same
					if(storedReceiptItem.additionValues.length != 0 && newReceiptItem.additionValues.length != 0)
						if(areSameAdditions(storedReceiptItem.additionValues, newReceiptItem.additionValues))
							return true;
						else
							return false;
					else
						return true;
				}
				else
					return false;
			}
			else {
				return false;
			}
		}

		function areSameAdditions(storedAdditions, newAdditions) {
			var storedAdditionsToArray = new Array(), newAdditionsToArray = new Array();

			// Store all additions in an array
			for(var addition in storedAdditions)
				if(storedAdditions.hasOwnProperty(addition))
					storedAdditionsToArray.push(storedAdditions[addition]);

			for(var addition in newAdditions)
				if(newAdditions.hasOwnProperty(addition))
					newAdditionsToArray.push(newAdditions[addition]);

			storedAdditionsToArray.sort(compareAdditions);
			newAdditionsToArray.sort(compareAdditions);

			if(storedAdditionsToArray.length == newAdditionsToArray.length) {
				var flag = 0;
				for(var i = 0; i < storedAdditionsToArray.length; i++) {
					if(storedAdditionsToArray[i].additionId == newAdditionsToArray[i].additionId
						&& storedAdditionsToArray[i].name == newAdditionsToArray[i].name
						&& storedAdditionsToArray[i].price == newAdditionsToArray[i].price
						&& storedAdditionsToArray[i].oid == newAdditionsToArray[i].oid
						&& storedAdditionsToArray[i].priceWithoutVAT == newAdditionsToArray[i].priceWithoutVAT)
						flag++;
					else
						return false;
				}
				if(flag > 0)
					return true;
				else
					return false;
			}
			else
				return false;
		}

		function compareAdditions(a,b) {
			if (a.oid < b.oid)
				return -1;
			if (a.oid > b.oid)
				return 1;
			return 0;
		}

		function addReceiptItemsAmountToAdditions(receiptItems) {
			for(var key in receiptItems) {
				if(receiptItems.hasOwnProperty(key)) {
					for(var key2 in receiptItems[key].additionValues)
						if(receiptItems[key].additionValues.hasOwnProperty(key2))
							receiptItems[key].additionValues[key2].amount = receiptItems[key].amount;
				}
			}
		}

		function checkPaymentOptionalInfoPresent(payments) {
			var creditCardPayments = new Array();
			for(var key in payments)
				if(payments.hasOwnProperty(key))
					if(checkIfNotZeroEmptyOrNull(payments[key].optionalInfo))
						creditCardPayments.push(payments[key]);
			if(creditCardPayments.length != 0)
				return creditCardPayments;
			else
				return null;
		}

				
		function getChange(receiptTotal,payments) {
			return getPayment(payments) - receiptTotal - calculateTip(payments);	
		}

		function calculateDiscount(receipts) {
			var discount = 0;

			checkIfNotZeroEmptyOrNull(receipts.actionReceiptItems)
				for(var key in receipts.actionReceiptItems)
					if(receipts.actionReceiptItems.hasOwnProperty(key))
						if(receipts.actionReceiptItems[key].priceTypeId > 50 && receipts.actionReceiptItems[key].priceTypeId < 57)
							discount += receipts.actionReceiptItems[key].price * receipts.actionReceiptItems[key].amount;

			checkIfNotZeroEmptyOrNull(receipts.receiptItems)
				for(var key in receipts.receiptItems)
					if(receipts.receiptItems.hasOwnProperty(key))
						if(receipts.receiptItems[key].priceTypeId > 50 && receipts.receiptItems[key].priceTypeId < 57)
							discount += receipts.receiptItems[key].price * receipts.receiptItems[key].amount;

			return discount;
		}

		function calculateServiceCharge(receipts) {
			var serviceCharge = 0;

			checkIfNotZeroEmptyOrNull(receipts.actionReceiptItems)
				for(var key in receipts.actionReceiptItems)
					if(receipts.actionReceiptItems.hasOwnProperty(key))
						if((receipts.actionReceiptItems[key].priceTypeId > 59 && receipts.actionReceiptItems[key].priceTypeId < 62) || (receipts.actionReceiptItems[key].priceTypeId > 69 && receipts.actionReceiptItems[key].priceTypeId < 78))
							serviceCharge += receipts.actionReceiptItems[key].price * receipts.actionReceiptItems[key].amount;

			checkIfNotZeroEmptyOrNull(receipts.receiptItems)
				for(var key in receipts.receiptItems)
					if(receipts.receiptItems.hasOwnProperty(key))
						if((receipts.receiptItems[key].priceTypeId > 59 && receipts.receiptItems[key].priceTypeId < 62) || (receipts.receiptItems[key].priceTypeId > 69 && receipts.receiptItems[key].priceTypeId < 78))
							serviceCharge += receipts.receiptItems[key].price * receipts.receiptItems[key].amount;

			return serviceCharge;
		}

		function calculateSubtotal(total) {
			return total - calculateDiscount(completeReceipt.receipt) - calculateServiceCharge(completeReceipt.receipt);
		}
	</script>
	<script id="headerTemplate" type="text/x-jquery-tmpl">
		{{if checkIfNotZeroEmptyOrNull(template.logoUrl)}}
			<div class="alignCenter">
				<img src="${template.logoUrl}"/>
			</div>
			<br class="clearBoth">
		{{/if}}
      
		{{if checkIfNotZeroEmptyOrNull(template.title)}}
			{{if window.posTitleWithUnderline == 1}}
				<div align="center" i21B='bigFontSize'><u>${template.title}</u></div>
			{{else}}
				<div align="center" i21B='bigFontSize'>${template.title}</div>
			{{/if}}
		{{/if}}

		{{if window.posUserAvailable == 1 && window.posTableAvailable == 1 && window.posReceiptAvailable == 1}}
			{{if template.showWaiterTableTime == 1}} 
				<p class="floatLeft">${table.name}</p>
				<p class="floatRight alignRight">${dateToString("", 1)}</p>
				<p class="floatLeft marginClearLeft">${receipt.numberOfCustomers} cts</p>
				<p class="floatRight marginClearRight">${receipt.sequenceNumber}</p>
				{{if isDineIn(receipt.type)}}
					<p class="floatLeft marginClearLeft">Dine in</p>
				{{else}}
					<p class="floatLeft marginClearLeft">Take-out</p>
				{{/if}}
				<p class="floatRight marginClearRight">${user.username}</p>
				{{if window.posCustomerAvailable == 1}}
					{{if checkIfNotZeroEmptyOrNull(customer.firstname) && checkIfNotZeroEmptyOrNull(customer.lastname)}}
						<p class="floatLeft marginClearLeft"><b>${markUpName(customer.firstname)} ${markUpName(customer.lastname)}</b></p>
					{{else checkIfNotZeroEmptyOrNull(customer.firstname) && !checkIfNotZeroEmptyOrNull(customer.lastname)}}
						<p class="floatLeft marginClearLeft"><b>${markUpName(customer.firstname)}</b></p>
					{{else checkIfNotZeroEmptyOrNull(customer.lastname) && !checkIfNotZeroEmptyOrNull(customer.firstname)}}
						<p class="floatLeft marginClearLeft"><b>${markUpName(customer.lastname)}</b></p>
					{{/if}}
				{{/if}}
			{{/if}}
		{{/if}}
    </script>
	<script id="receiptItemsTemplate" type="text/x-jquery-tmpl">
		{{if !(priceTypeId == 11 && parentRiReceiptId != 0 && window.posShowBranches == 0) && !(priceTypeId == 12 && parentRiReceiptId != 0 && window.posShowBranches == 0) && (priceTypeId < 51 || priceTypeId > 56) && (priceTypeId < 60 || priceTypeId > 61) && (priceTypeId < 70 || priceTypeId > 77)}}
			<tr>
				{{if price == 0}}
					{{if window.posShowZeroValuedPricesProducts == 1 || (window.posShowZeroValuedPricesProducts == 0 && productIsOffert(name) && window.posShowOfferts == 1) || calculateAdditionsPrices(additionValues, 1) > 0}}
						<td class="hideItem">${line}</td>
						{{if parentRiReceiptId != 0}}
							<td class="widthTen" i21D='defaultFontSize'></td>
						{{else}}
							<td class="widthTen" i21D='defaultFontSize'>${amount}</td>
						{{/if}}
						{{if parentRiReceiptId != 0}}
							<td class="name alignLeft widthSixty" i21D='defaultFontSize'>- ${name}</td>
						{{else}}
							<td class="name alignLeft widthSixty" i21D='defaultFontSize'>${name}</td>
						{{/if}}
						{{if window.posShowPrice == 1}}
							{{if (priceTypeId == 11 || priceTypeId == 12) || parentRiReceiptId == 0}}
								{{if window.posShowAdditions == 1}}
									<td class="alignRight" i21D='defaultFontSize'>${(amount*price).toFixed(2)}</td>
								{{else}}
									<td class="alignRight" i21D='defaultFontSize'>${(amount*price + (calculateAdditionsPrices(additionValues, 1))).toFixed(2)}</td>
								{{/if}}
							{{else}}
								<td></td>
							{{/if}}
						{{/if}}			
					{{else}}
						<td class="hideItem"></td><td></td><td></td><td></td>
					{{/if}}
				{{else}}
					<td class="hideItem">${line}</td>
					{{if parentRiReceiptId != 0}}
						<td class="amount widthTen" i21D='defaultFontSize' id="firstRow"></td>
					{{else}}
						<td class="amount widthTen" i21D='defaultFontSize' id="firstRow">${amount}</td>
					{{/if}}
					{{if parentRiReceiptId != 0}}
						<td class="amount widthTen" i21D='defaultFontSize'>- ${name}</td>
					{{else}}
						<td class="amount widthTen" i21D='defaultFontSize'>${name}</td>
					{{/if}}
					{{if window.posShowPrice == 1}}
						{{if (priceTypeId == 11 || priceTypeId == 12) || parentRiReceiptId == 0}}
							{{if window.posShowAdditions == 1}}
								<td class="alignRight" i21D='defaultFontSize'>${(amount*price).toFixed(2)}</td>
							{{else}}
								<td class="alignRight" i21D='defaultFontSize'>${(amount*price + (calculateAdditionsPrices(additionValues, 1))).toFixed(2)}</td>
							{{/if}}
						{{else}}
							<td></td>
						{{/if}}
					{{/if}}
				{{/if}}
			</tr>
			
			{{if checkIfNotZeroEmptyOrNull(additionValues)}}
				{{if window.posShowAdditions == 1}}
					{{if calculateAdditionsPrices(additionValues) > 0 && productIsOffert(name) == false}}
						{{tmpl(additionValues) "#additionValueTemplate"}}
					{{else productIsOffert(name) && window.posShowOfferts == 1}}
						{{tmpl(additionValues) "#additionValueTemplate"}}
					{{else window.posShowZeroValuedAdditions == 1 && productIsOffert(name) == false}}
						{{tmpl(additionValues) "#additionValueTemplate"}}
					{{/if}}
				{{/if}}
			{{/if}}
		{{/if}}
	</script>
    <script id="additionValueTemplate" type="text/x-jquery-tmpl">
		<tr>
			<td class="hideItem"></td><td></td>
			{{if price == 0}}
				{{if window.posShowZeroValuedAdditions == 1}}
					{{if info == ""}}	
						<td class="alignLeft widthTen" i21S='smallFontSize' style="font-style:italic;">* ${name}</td>
					{{else}}
						<td class="alignLeft widthTen" i21S='smallFontSize' style="font-style:italic;">* ${info} ${name}</td>
					{{/if}}
					{{if window.posShowPrice == 1}}
						<td class="alignRight" i21S='smallFontSize' style="font-style:italic;">${(amount*price).toFixed(2)}</td>
					{{else}}
						<td></td>
					{{/if}}
				{{else}}
					<td></td><td></td>
				{{/if}}
			{{else}}
				{{if info == ""}}	
					<td class="alignLeft widthTen" i21S='smallFontSize' style="font-style:italic;">* ${name}</td>
				{{else}}
					<td class="alignLeft widthTen" i21S='smallFontSize' style="font-style:italic;">* ${info} ${name}</td>
				{{/if}}					
				{{if window.posShowPrice == 1}}
					<td class="alignRight" i21S='smallFontSize' style="font-style:italic;">${(amount*price).toFixed(2)}</td>
				{{else}}
					<td></td>
				{{/if}}
			{{/if}}			
		</tr>  
	</script>
	<script id="subtotalsTemplate" type="text/x-jquery-tmpl">
		<tr>		
			<th class="alignLeft">Subtotaal</th>
			<td class="floatRight"><b>${calculateSubtotal(total).toFixed(2)}</b></td>		
		</tr>
	</script>	
	<script id="discountsTemplate" type="text/x-jquery-tmpl">
		<tr>		
			<th class="alignLeft fontWeightNormal">Korting</th>
			<td class="floatRight">${calculateDiscount(completeReceipt.receipt).toFixed(2)}</td>
		</tr>
	</script>
	<script id="gratuityTemplate" type="text/x-jquery-tmpl">
		{{if (priceTypeId > 59 && priceTypeId < 68 && price != 0) || (priceTypeId > 69 && priceTypeId < 78 && price != 0)}}
			<tr>
				<th class="alignLeft fontWeightNormal">Service Charge</th>
				<td class="floatRight">${price.toFixed(2)}</td>
			</tr>			
		{{/if}}
	</script>
	<script id="totalTipTemplate" type="text/x-jquery-tmpl">
		<tr>
			<th class="alignLeft fontWeightNormal">Tip</th>
			<td class="floatRight">${calculateTip(payments).toFixed(2)}</td>
		</tr>
	</script>
	<script id="receiptTotals" type="text/x-jquery-tmpl">
		<tr>		
			<th class="alignLeft">Totaal</th>
			<td class="floatRight"><b>${((receipt.total + calculateTip(payments)).toFixed(2))}</b></td>		
		</tr>
	</script> 
	<script id="paymentTypeTemplate" type="text/x-jquery-tmpl">
		<tr>
			<th class="alignLeft fontWeightNormal">${type}</th>
			<td class="floatRight">${amount.toFixed(2)}</td>
		</tr>
	</script> 
	<script id="vatTemplate" type="text/x-jquery-tmpl">
		{{if window.posVatAvailable == 1}}
			{{if price != 0}}
				<tr>
					<td i21D='defaultFontSize'><p2>BTW ${vat}%:</p2></td>
					<td i21D='defaultFontSize' class="alignRight">${(price - price*vat/(100.0+parseFloat(vat))).toFixed(window.completeReceipt.template.nrOfDecimalsToRoundVATTo)}		</td>
					<td i21D='defaultFontSize' class="alignRight">${(price*vat/(100.0+parseFloat(vat))).toFixed(window.completeReceipt.template.nrOfDecimalsToRoundVATTo)}</td>			
					<td i21D='defaultFontSize' class="floatRight">${price.toFixed(window.completeReceipt.template.nrOfDecimalsToRoundVATTo)}</td>
				</tr>	
			{{/if}}
		{{/if}}
	</script>
	<script id="totalAmountTemplate" type="text/x-jquery-tmpl">
		{{if window.posPaymentsAvailable == 1 && window.posReceiptAvailable == 1}}
			{{if checkIfNotZeroEmptyOrNull(payments) && window.posShowPayments == 1}}
				<tr>
					{{if payments}}
						<th class="alignLeft"><b>Betaald</b</th>
					{{/if}}
					
					 {{if payments}}
						<td class="floatRight"><b>${getPayment(payments).toFixed(2)}<b></td>
					{{/if}}
					
					{{if typeof(payments) == "undefined"}}
						<td class="floatRight">${receipt.total.toFixed(2)}</td>
					{{/if}}		
				</tr>
			{{/if}}
		{{/if}}
	</script> 
	<script id="changeTemplate" type="text/x-jquery-tmpl">			
		<tr>
			{{if getChange(receipt.total,payments) > 0}}
				<th class="alignLeft">Wisselgeld</th>
				<td class="floatRight"><b>${getChange(receipt.total,payments).toFixed(2)}</b></td>
			{{else getChange(receipt.total,payments) < 0}}
				<th class="alignLeft">Saldo</th>
				<td class="floatRight"><b>${((getChange(receipt.total,payments)) * -1).toFixed(2)}</b></td>
			{{/if}}
		</tr>
	</script>
	<script id="thankYouTemplate" type="text/x-jquery-tmpl">
		{{if window.posEnableThankYouUnderline == 1}}		
			<p class="widthHundred alignCenter"><u>${thankYouText}</u></p>
		{{else}}
			<p class="widthHundred alignCenter">${thankYouText}</p>
		{{/if}}	
	</script>
	<script id="promotionTemplate" type="text/x-jquery-tmpl">
		{{if window.posEnablePromotionYouUnderline == 1}}		
			<p class="widthHundred alignCenter" style="display:inline-block"><u>${promotionText}</u></p>
		{{else}}
			<p class="widthHundred alignCenter">${promotionText}</p>
		{{/if}}	
	</script>
	<script id="footerTemplate" type="text/x-jquery-tmpl">
		{{if window.posCustomerAvailable == 1}}
			{{if checkIfNotZeroEmptyOrNull(customer)}}
				{{if window.posShowCustomerInfo == 1}}
					<div id="takeAwayInfo" i21D='defaultFontSize'>
						<div class="floatLeft">
							{{if checkIfNotZeroEmptyOrNull(customer.firstname) && checkIfNotZeroEmptyOrNull(customer.lastname)}}
								<p><b>${markUpName(customer.firstname)} ${markUpName(customer.lastname)}</b></p>
							{{else checkIfNotZeroEmptyOrNull(customer.firstname) && !checkIfNotZeroEmptyOrNull(customer.lastname)}}
								<p><b>${markUpName(customer.firstname)}</b></p>
							{{else checkIfNotZeroEmptyOrNull(customer.lastname) && !checkIfNotZeroEmptyOrNull(customer.firstname)}}
								<p><b>${markUpName(customer.lastname)}</b></p>
							{{/if}}
							{{if checkIfNotZeroEmptyOrNull(customer.street) && checkIfNotZeroEmptyOrNull(customer.streetNumber) && checkIfNotZeroEmptyOrNull(customer.zip) && checkIfNotZeroEmptyOrNull(customer.city)}}
								<p>${customer.street} ${customer.streetNumber} ${customer.zip} ${customer.city}</p>
							{{/if}}
							{{if checkIfNotZeroEmptyOrNull(customer.telephone)}}
								<p>${customer.telephone}</p>
							{{/if}}
							{{if checkIfNotZeroEmptyOrNull(customer.email)}}
								<p>${customer.email}</p>
							{{/if}}
							{{if checkIfNotZeroEmptyOrNull(receipt.type)}}
								<p>${receipt.type}</p>
							{{/if}}
							<p>${dateToString(receipt.deliveryDate, 1)}</p>
							{{if checkIfNotZeroEmptyOrNull(customer.credits)}}
								<p>New credit balance: ${customer.credits}</p>	
							{{/if}}
						</div>	
					</div>		
				{{/if}}
			{{/if}}
		{{/if}}
		{{if completeReceipt.template.showCompanyInfo == 1}}
			<div id="restaurantInfo" i21D='defaultFontSize'>
				{{if window.posEnableCustomerInfoCentering == 1 && receipt.url == ""}}
					<div id="centeredCompanyInfo" class='spreadEvenly'>
				{{else}}
					<div class="floatLeft">				
				{{/if}}
					{{if window.posCompanyAvailable == 1 && window.posUserAvailable == 1}}
						{{if checkIfNotZeroEmptyOrNull(company)}}
								<p><b>${company.displayName}</b></p>
								<p>${company.street} ${company.streetNumber}</p>
								<p>${company.zip} ${company.city}</p>
								<p>${company.telephone}</p>
								<p>${company.vat}</p>
								<p>${company.url}</p>
								<p>${user.email}</p>
							</div>	
						{{/if}}
					{{/if}}
			</div>
		{{/if}}
		{{if checkIfNotZeroEmptyOrNull(template.bottomLogoUrl)}}
			{{if window.posShowBottomLogo == 1}}
				{{if window.posEnableBottomLogoTopline == 1}}
					<div class="borderTop" style="text-align:center;clear:both">
				{{else}}
					<div style="text-align:center;clear:both;">
				{{/if}}
						<img src="${template.bottomLogoUrl}"/>
					</div>
			{{/if}}
		{{/if}}
	</script>
    <script id="signatureTemplate" type="text/x-jquery-tmpl">
    	<div id="signatureDiv">
	    	<p><b>Card information</b></p>
	    	<p class="floatLeft widthFifty">Cardholder:</p><p class="floatRight widthFifty alignRight">${cardHolder}</p>
	    	<p class="floatLeft widthFifty">Cardnumber:</p><p class="floatRight widthFifty alignRight">xxx...x${cardNumber}</p>
	    	<br/></br></br></br>
	    	<p style="border-bottom:1px dotted;">Signature line:</p>
	    </div>
    </script>
	<script type="text/javascript">
var completeReceipt = {company:{"city":"Ghent","takeawayPopup":true,"imageLocation":"","blackBoxSerialPortName":null,"blackBoxServerMacAddress":null,"timezone":1,"streetNumber":"1","customerSelectionPopup":true,"url":null,"smtpUserName":null,"useUserClockTimes":false,"showProductReportAdditionValues":true,"currency":null,"type":"","email":"","combineBarAndKitchen":false,"showDayReportTableDetails":false,"shouldGoToTablesWhenNothingNeedsToBePrinted":false,"digitalMenuCardUrl":"","showProductReportAdditionValueDetails":true,"productSmallFontSize":20,"displayName":"JUNIT","productBigFontSize":25,"enforceStock":false,"vatInclusive":true,"openingstime":21600000,"account":null,"name":"JUnit","showDayReportCategoryDetails":false,"showDayReportDetails":false,"notifyKitchen":true,"gsm":"","closingtime":108000000,"info":"","autoLogin":false,"showDayReportTips":false,"street":"Unitstreet","generateClosingTimeReport":false,"imageUrl":"","users":[],"shouldWarnIfNonPrintedItems":false,"zip":"9070","vat":"10","serviceChargeWithoutDiscount":false,"smtpHost":null,"showDayReportProductDetails":false,"blackBoxPinCode":null,"smtpPort":null,"telephone":"0494541334","fax":"","smtpPassword":null,"oid":8421,"invoiceNumberTemplate":"","country":"United States"},receipt:{"invoiceNumber":null,"url":"www.posios.com123456789123456789123456789123456789123456789","modificationDate":1396709144608,"userId":18029,"sequenceNumber":705,"customerId":0,"oid":"90054","info":"","type":"restaurant","znumber":0,"printDate":1396709144608,"parentId":"0","vat":0,"deliveryDate":0,"lockDeviceIdentifier":"C4B5CC94-C51C-4FE6-AE01-3742626814D4","numberOfCustomers":0,"receiptItems":[{"displayName":"","totalPrice":6,"modifierUserId":18029,"priceTypeId":0,"additionUpdateId":0,"modificationDate":1396702375030,"barcode":null,"name":"drink2éüà¥'\"","pOid":78375,"oid":1329641,"info":"","creatorUserId":18029,"receiptId":90054,"riReceiptId":1,"vat":21,"customerNr":1,"barcode2":null,"amount":1,"pId":"dc2","price":5,"kitchenName":"drink2 kitchenName","additionValues":[{"additionId":681,"name":"payedOne","price":1,"oid":1831,"priceWithoutVAT":0,"info":""}],"statusId":0,"parentRiReceiptId":0,"deliveryVat":0,"creationDate":1396702375030,"status":"executed","takeawayVat":0},{"displayName":"","totalPrice":10,"modifierUserId":18029,"priceTypeId":0,"additionUpdateId":0,"modificationDate":1396702375030,"barcode":null,"name":"drinkWithAddition","pOid":78376,"oid":1329642,"info":"","creatorUserId":18029,"receiptId":90054,"riReceiptId":2,"vat":21,"customerNr":1,"barcode2":null,"amount":1,"pId":"dc3","price":10,"kitchenName":"drinkWithAddition kitchenName","additionValues":[{"additionId":611,"name":"additionValueMulti1","price":0,"oid":1591,"priceWithoutVAT":0,"info":""}],"statusId":0,"parentRiReceiptId":0,"deliveryVat":0,"creationDate":1396702375030,"status":"executed","takeawayVat":0},{"displayName":"","totalPrice":0,"modifierUserId":18029,"priceTypeId":0,"additionUpdateId":0,"modificationDate":1396702375030,"barcode":null,"name":"drinkWithAutoAddition *","pOid":78458,"oid":1329643,"info":"","creatorUserId":18029,"receiptId":90054,"riReceiptId":3,"vat":21,"customerNr":1,"barcode2":null,"amount":1,"pId":"dc4","price":0,"kitchenName":"","additionValues":[],"statusId":0,"parentRiReceiptId":0,"deliveryVat":0,"creationDate":1396702375030,"status":"executed","takeawayVat":0},{"displayName":"","totalPrice":-1.6000000000000001,"modifierUserId":18029,"priceTypeId":54,"additionUpdateId":0,"modificationDate":1396705945405,"barcode":null,"name":"Reduction Ticket Percentage 10% (Tax: 21%)","pOid":81311,"oid":1329644,"info":"54","creatorUserId":18029,"receiptId":90054,"riReceiptId":4,"vat":21,"customerNr":0,"barcode2":null,"amount":1,"pId":"d4","price":-1.6000000000000001,"kitchenName":"Reduction Ticket Percentage 10%","additionValues":[],"statusId":0,"parentRiReceiptId":0,"deliveryVat":0,"creationDate":1396705945405,"status":"executed","takeawayVat":0}],"payed":false,"deliveryDelay":0,"actionReceiptItems":[{"displayName":"","totalPrice":2.8799999999999999,"modifierUserId":18029,"priceTypeId":73,"additionUpdateId":0,"modificationDate":1396706115608,"barcode":null,"name":"ServiceChargeRestaurantAutomaticPercentage","pOid":78390,"oid":1329645,"info":"73","creatorUserId":18029,"receiptId":90054,"riReceiptId":5,"vat":0,"customerNr":0,"barcode2":null,"amount":1,"pId":"s2","price":2.8799999999999999,"kitchenName":"ServiceChargeRestaurantAutomaticPercentage kitchenName","additionValues":[],"statusId":0,"parentRiReceiptId":0,"deliveryVat":0,"creationDate":1396706115608,"status":"in request","takeawayVat":0}],"hasChildren":false,"tableId":"121865","footer":null,"foid":0,"dayReceiptId":0,"creationDate":1396702311874,"status":"waiting for payment","stamp":"","total":17.280000000000001},template:{"showCustomerInfo":false,"fontName":"Arial","bigFontSize":45,"printTemplateTypeId":1,"nrOfDecimals":0,"companyId":8421,"showWaiterTableTime":true,"signalAccessory":false,"amountWidth":3,"promotionText":"Powered by POSIOS","type":"Receipt","templateUrl":"http://dev.posios.com:8080/posimages/junit_17441/templates/4198.html","smallFontName":"Arial","printerId":518,"fontSize":25,"priceWidth":6,"productDisplayNamesIndex":0,"name":"Receipt","oid":4198,"showCompanyInfo":true,"smallFontSize":16,"logoUrl":"http://dev.posios.com:8080/posimages/junit_17441/images/companyLogo/LOGO-NEUTRALBAY%20copy.jpg","bottomLogoUrl":null,"showVat":true,"printAmount":1,"printNameId":0,"showTotalPrice":true,"bigFontName":"Arial-BoldMT","thankYouText":"Thanks and see you soon!","showSequenceNumber":false,"title":"JUnit","nrOfDecimalsToRoundVATTo":2,"nrWidth":2,"template":null},user:{"visible":true,"socialSecurityNumber":"","city":"","uuid":"521474fb-4a56-440e-a8cd-0bc54bcf04a4","streetNumber":"","zip":"","companyId":8421,"imageLocation":"http://dev.posios.com:8080/posimages/MAIN/images/standarduser.png","sex":null,"oid":18029,"type":"employee","password":"","email":"nicolas.deletter@posios.com","serverport":0,"serverprotocol":null,"serverextension":null,"customerId":0,"street":"","telephone":"","lastname":"","username":"nicolas.deletter@posios.com","role":null,"country":"","server":null,"age":0,"lastClockInTime":0,"creationDate":0,"gsm":"","firstname":"","defaultFloorId":4572},table:{"imageLocation":"http://dev.posios.com:8080/posimages/MAIN/images/table1.png","status":"waiting for payment","numberOfClients":4,"chairImageLocation":"http://dev.posios.com:8080/posimages/MAIN/images/whitechair.png","x":6,"width":99,"ellipse":false,"type":"restaurant","y":23,"oid":"121865","height":40,"companyId":8421,"info":"","rotation":0,"floorId":4572,"name":"T-1","tableOrder":0,"zindex":0},vat:{"0":2.8799999999999999,"21":14.4},barItems:[],kitchenItems:[],payments:[{"type":"Cheque","paymentTypeTypeId":3,"name":"Cheque","optionalInfo":null,"tips":0,"amount":5},{"type":"Cash","paymentTypeTypeId":1,"name":"Cash","optionalInfo":null,"tips":1,"amount":5}],device:{"applicationVersion":null,"type":null,"name":null,"deviceModel":null,"companyId":8421,"applicationId":null,"optout":0,"oid":9053,"printTemplateId":0,"deviceVersion":null,"deviceId":"C4B5CC94-C51C-4FE6-AE01-3742626814D4"}, customer:{"email":null,"language":null,"deliveryStreetNumber":null,"username":null,"clientId":0,"deliveryCity":null,"birthYear":0,"lastname":null,"companyId":0,"gsm":null,"refererId":0,"uuid":null,"type":null,"visible":false,"role":null,"birthMonth":0,"sex":null,"partnerCustomerId":0,"deliveryCountry":null,"deliveryStreet":null,"deliveryZip":null,"firstname":null,"creationDate":0,"imageLocation":null,"oid":0,"zip":null,"usedCards":[],"vatNumber":null,"lastVisitDate":0,"street":null,"city":null,"birthDay":0,"country":null,"streetNumber":null,"password":null,"receiveNewsLetter":false,"age":0,"verified":false,"telephone":null,"socialSecurityNumber":null,"credits":0}, productCategories:[{"displayName":null,"printTemplateId":4171,"deliveryVat":20,"vat":21,"printer":"","additionIds":[],"products":[{"dealer":"","displayName":"","visible":true,"priceTypeId":0,"priceWithoutVAT":0,"totalPrice":0,"imageLocation":"http://dev.posios.com:8080/posimages/MAIN/images/products/pangasius.jpg","takeawayPrice":4,"stockAmount":-331,"name":"drink2éüà¥'\"","manufacturer":"","oid":78375,"info":"this drink gets your drunk and fucks up your mind.","tempTime":0,"barcode":"","vat":21,"displayNames":["drink2éüà¥'\"","drink2 kitchenName"],"deliveryPrice":3,"cost":0,"pId":"dc2","price":5,"kitchenName":null,"deliveryPriceWithoutVAT":-1,"orderAmount":0,"takeawayPriceWithoutVAT":-1,"additionIds":[681],"productTypeId":4278190080,"deliveryVat":20,"takeawayVat":19,"subProductIds":null,"productCategoryId":32573},{"dealer":"","displayName":"","visible":true,"priceTypeId":0,"priceWithoutVAT":0,"totalPrice":0,"imageLocation":"http://dev.posios.com:8080/posimages/MAIN/images/products/p1.png","takeawayPrice":10,"stockAmount":-182,"name":"drinkWithAddition","manufacturer":"","oid":78376,"info":"","tempTime":0,"barcode":"","vat":21,"displayNames":["drinkWithAddition","drinkWithAddition kitchenName"],"deliveryPrice":10,"cost":0,"pId":"dc3","price":10,"kitchenName":null,"deliveryPriceWithoutVAT":-1,"orderAmount":0,"takeawayPriceWithoutVAT":-1,"additionIds":[611,681],"productTypeId":4278190080,"deliveryVat":20,"takeawayVat":19,"subProductIds":null,"productCategoryId":32573},{"dealer":"","displayName":"","visible":true,"priceTypeId":0,"priceWithoutVAT":0,"totalPrice":0,"imageLocation":"http://dev.posios.com:8080/posimages/MAIN/images/products/lam.jpg","takeawayPrice":11,"stockAmount":-93,"name":"drinkWithAutoAddition","manufacturer":"","oid":78458,"info":"","tempTime":0,"barcode":"","vat":21,"displayNames":["drinkWithAutoAddition",""],"deliveryPrice":11,"cost":0,"pId":"dc4","price":11,"kitchenName":null,"deliveryPriceWithoutVAT":-1,"orderAmount":0,"takeawayPriceWithoutVAT":-1,"additionIds":[681],"productTypeId":4278190080,"deliveryVat":20,"takeawayVat":19,"subProductIds":null,"productCategoryId":32573}],"takeawayVat":19,"oid":32573,"printOrder":1,"info":"","companyId":8421,"name":"drinkCategory","printTemplateIds":[4171],"imageLocation":"http://dev.posios.com:8080/posimages/MAIN/images/productCategories/aperitief.png"},{"displayName":null,"printTemplateId":0,"deliveryVat":0,"vat":0,"printer":"","additionIds":[],"products":[{"dealer":"","displayName":"","visible":true,"priceTypeId":54,"priceWithoutVAT":0,"totalPrice":0,"imageLocation":"","takeawayPrice":10,"stockAmount":-63,"name":"Reduction Ticket Percentage 10%","manufacturer":"","oid":81311,"info":"","tempTime":0,"barcode":"","vat":0,"displayNames":["Reduction Ticket Percentage 10%","Reduction Ticket Percentage 10%"],"deliveryPrice":10,"cost":0,"pId":"d4","price":10,"kitchenName":null,"deliveryPriceWithoutVAT":-1,"orderAmount":0,"takeawayPriceWithoutVAT":-1,"additionIds":null,"productTypeId":4278190080,"deliveryVat":0,"takeawayVat":0,"subProductIds":null,"productCategoryId":32577}],"takeawayVat":0,"oid":32577,"printOrder":1,"info":"","companyId":8421,"name":"discounts","printTemplateIds":[],"imageLocation":"http://dev.posios.com:8080/posimages/MAIN/images/productCategories/warmdrink.png"},{"displayName":null,"printTemplateId":0,"deliveryVat":0,"vat":0,"printer":"","additionIds":[],"products":[{"dealer":"","displayName":"","visible":true,"priceTypeId":73,"priceWithoutVAT":0,"totalPrice":0,"imageLocation":"","takeawayPrice":0,"stockAmount":-403,"name":"ServiceChargeRestaurantAutomaticPercentage","manufacturer":"","oid":78390,"info":"ServiceChargeRestaurantAutomaticPercentage description","tempTime":0,"barcode":"","vat":0,"displayNames":["ServiceChargeRestaurantAutomaticPercentage","ServiceChargeRestaurantAutomaticPercentage kitchenName"],"deliveryPrice":20,"cost":0,"pId":"s2","price":20,"kitchenName":null,"deliveryPriceWithoutVAT":-1,"orderAmount":0,"takeawayPriceWithoutVAT":-1,"additionIds":null,"productTypeId":4278190080,"deliveryVat":0,"takeawayVat":0,"subProductIds":null,"productCategoryId":32578}],"takeawayVat":0,"oid":32578,"printOrder":1,"info":"","companyId":8421,"name":"service charge","printTemplateIds":[],"imageLocation":"http://dev.posios.com:8080/posimages/MAIN/images/productCategories/aperitief.png"}], additionValues: [{"additionId":681,"name":"payedOne","price":1,"oid":1831,"priceWithoutVAT":0,"info":""},{"additionId":611,"name":"additionValueMulti1","price":0,"oid":1591,"priceWithoutVAT":0,"info":""}], serverInfo: {"blackBoxServerMacAddress":null,"version":"Version 3.01.6508 Posios Server","posiosBlackBoxCertificationCode":null}, parentItems: []}; /*console.log(completeReceipt);*/ try {jQuery(document).ready(function($) {search(completeReceipt);location.href = 'posios://print';});} catch(e) {'print error:' + e.message +' '+ e;}	

	function search(completeReceipt) {		
		// Make sure completeReceipt is globally accessible
		window.completeReceipt = completeReceipt;
		// When set to 1, an underline will be added to the title.
		window.posTitleWithUnderline = 0;
		// When set to 1, a topline will be drawn above the info section.
		window.posEnableInfoTopline = 0;
		// When set to 1, a line will be drawn underneath the receipt info.
		window.posEnableInfoSubline = 0;
		// When set to 0, the headers of the receipt items will not be shown (#, Name, Price).
		window.posShowReceiptItemsHeaders = 1;
		// When set to a value, the value will be added as margin to the head of the receipt items list. Start at 100;
		window.posAddReceiptItemsTopMargin = 100;
		// When set to a value, the value will be added as margin to the bottom of the receipt items list. Start at 10;
		window.posAddReceiptItemsBottomMargin = 10;
		// When set to 1, the prices will be shown.
		window.posShowPrice = 1;
		// When set to 1, additions will be printed.
		window.posShowAdditions = 1;
		// When set to 1, additions of value zero will be printed.
		window.posShowZeroValuedAdditions = 0;
		// When set to 1, the prices of the products with a value of zero will be printed.
		window.posShowZeroValuedPricesProducts = 0;
		// When set to 1, offerts will be shown even though products with price zero are not shown.
		window.posShowOfferts = 0;
		// When set to 1, a line will be drawn underneath the body of the receipt.
		window.posEnableBodySubline = 0;
		// When set to 1, a line will be drawn underneath the total price.
		window.posEnableTotalSubline = 0;
		// When set to a value, the value will be added as margin to the bottom of the total price. Start at 10;
		window.posAddTotalBottomMargin = 30;
		// When set to 1, the payments will be shown.
		window.posShowPayments = 1;
		// When set to 1, the payment header "Payment" and "Amount" will be shown.
		window.posShowHeadersPaymentTypes = 1;
		// When set to 1, a line will be drawn underneath the change. If there is no change, the line will be drawn under total paid.
		window.posEnableChangeSubline = 0;
		// When set to a value, the value will be added as margin to the bottom of the payments list. Start at 10;
		window.posAddPaymentsBottomMargin = 30;
		// When set to 1, a line will be drawn underneath the VAT.
		window.posEnableVATSubline = 0;
		// When set to a value, the value will be added as margin to the bottom of the VAT list. Start at 10;
		window.posAddVATBottomMargin = 10;
		// When set to 1, a line will be drawn underneath the thank you text.
		window.posEnableThankYouSubline = 0;
		// when set to 1, the thank you text will be underlined.
		window.posEnableThankYouUnderline = 1;
		// When set to a value, the value will be added as margin to the bottom of the thank you text. Start at 10;
		window.posAddThankYouBottomMargin = 10;
		// When set to 1, a line will be drawn underneath the promotion text.
		window.posEnablePromotionSubline = 0;
		// when set to 1, the promotio  text will be underlined.
		window.posEnablePromotionYouUnderline = 0;		
		// When set to 1, a thin line will be drawn around the promotion text. 2 will draw a medium one, 3 a thick one. Default: no frame.
		window.posThicknessOfFramePromotion = 1;
		// When set to a value, the frame will be adjusted to the value in percentage. 80 Means 80% of the screen in width.
		window.posFrameWidth = 80;
		// When set to a value, the value will be added as margin to the bottom of the promotio text. Start at 10;
		window.posAddPromotionBottomMargin = 10;
		// When set to 1, the bottom logo will be printed provided the URL is correct.
		window.posShowBottomLogo = 1;
		// When set to 1, a line will be drawn underneath the bottom logo.
		window.posEnableBottomLogoTopline = 1;
		// When set to 1, the customer info will be shown at the bottom of the receipt.
		window.posShowCustomerInfo = 1;
		// When set to 1, a line will be drawn underneath the customer info.
		window.posEnableCustomerSubline = 0;
		// When set to 1, the customer information will be centered. *** When enabling this option, reset the width of the div with ID centeredCompanyInfo so that the div will actually be in the center ***.
		window.posEnableCustomerInfoCentering = 0;
		// Set this value to order by. Supported values are 'receiptItems.name', 'receiptItems.pId' (PLU), 'receiptItems.modificationDate'. When set to "", no ordering will happen. 
		window.posOrderBy = "";
		// When set to 1, the items will be ordered in ascending order. -1 Will do the opposite.
		window.posOrderDirection = -1;
		// When set to 1, a custom sort function is called. This cannot be used in conjuction with window.posOrderBy.
		window.posEnableSortOnCourseThenOnKitchenName = 0;
		// When set to 1, a subline will be drawn underneath total amount due.
		window.posEnableAmountDueSubline = 0;
		// When set to 1, a line will be drawn between the courses.
		 window.posEnableCourseLines = 0;
		// When set to 1, the receipt items will be combined. The app does not recognise the same items when the additions have been entered in a different order. This function will combine them.
		window.posEnableCombineItems = 0;
		// When set to 1, the titles of the menus/choices will be printed.
		window.posShowBranches = 0;
		// When set to 1, only the menu name will be displayed without the branches and products.
		window.posShowMenuOnly = 0;
		// When set to 1, the spare change will be displayed.
		window.posShowChange = 1;
		// When set to 1, multiple debug lines will be pinted to see where the error occurs when princing the receipt.
		window.posEnableDebug = 0;
		// These are values which test if objects are present. Do not touch.
		window.posCustomerAvailable = 0;
		window.posCompanyAvailable = 0;
		window.posReceiptAvailable = 0;
		window.posTemplateAvailable = 0;
		window.posUserAvailable = 0;
		window.posTableAvailable = 0;
		window.posVatAvailable = 0;
		window.posBarItemsAvailable = 0;
		window.posKitchenItemsAvailable = 0;
		window.posPaymentsAvailable = 0;
		window.posProductCategoriesAvailable = 0;
		window.posAdditionValuesAvailable = 0;
		window.posCount = 0;

		if(window.posEnableInfoTopline == 1)
			$("#header").attr("class", "borderBottom");

		if(window.posEnableInfoSubline == 1)
			$("#receiptItemsList").attr("class", "borderTop");
	
		if(window.posShowReceiptItemsHeaders == 0)
			$('#receiptItemsList tr:nth-child(1)').remove();

		if(checkIfNotZeroEmptyOrNull(window.posAddReceiptItemsTopMargin))
			$("#header").css('margin-bottom', window.posAddReceiptItemsTopMargin + 'px');

		if(checkIfNotZeroEmptyOrNull(window.posAddReceiptItemsBottomMargin))
			$("#receiptItemsList").css('margin-bottom', window.posAddReceiptItemsBottomMargin + 'px');

		if(window.posEnableBodySubline == 1)
			$("#receiptItemsList").attr("class", "borderBottom");

		if(window.posEnableTotalSubline == 1)
			$("#totals").attr("class", "borderBottom");

		if(checkIfNotZeroEmptyOrNull(window.posAddTotalBottomMargin))
			$("#totals").css('margin-bottom', window.posAddTotalBottomMargin + 'px');

		if(window.posShowHeadersPaymentTypes == 0)
			$("#paymentsTable tr:nth-child(1)").remove();	
	
		if(window.posEnableChangeSubline == 1)
			if(getChange(completeReceipt.receipt.total, completeReceipt.payments) != 0)
				$("#change").attr("class", "borderBottom");
			else
				$("#totalAmount").attr("class", "borderBottom");

		if(checkIfNotZeroEmptyOrNull(window.posAddPaymentsBottomMargin))
			if(getChange(completeReceipt.receipt.total, completeReceipt.payments) != 0)
				$("#change").css('margin-bottom', window.posAddPaymentsBottomMargin + 'px');
			else
				$("#totalAmount").css('margin-bottom', window.posAddPaymentsBottomMargin + 'px');

		if(window.posEnableVATSubline == 1)
			$("#vat").attr("class", "borderBottom");

		if(checkIfNotZeroEmptyOrNull(window.posAddVATBottomMargin))
			$("#vat").css('margin-bottom', window.posAddVATBottomMargin + 'px');

		if(window.posEnableThankYouSubline == 1)
			$("#thankYou").attr("class", "borderBottom");

		if(checkIfNotZeroEmptyOrNull(window.posAddThankYouBottomMargin))
			$("#thankYou").css('margin-bottom', window.posAddThankYouBottomMargin + 'px');

		if(window.posEnablePromotionSubline == 1)
			$("#promotion").attr("class", "borderBottom");

		if(window.posThicknessOfFramePromotion > 0) {
			switch(window.posThicknessOfFramePromotion) {
				case 1: $("#promotion").css("border", "thin solid black");
						break;
			}
			if(checkIfNotZeroEmptyOrNull(window.posFrameWidth))
				$("#promotion").css('width', window.posFrameWidth + '%');				
		}

		if(checkIfNotZeroEmptyOrNull(window.posAddPromotionBottomMargin))
			$("#promotion").css('margin-bottom', window.posAddPromotionBottomMargin + 'px');
					$("#promotion").css('margin-left', '10px');

	if(window.posCustomerAvailable == 1) {
		if (window.posShowCustomerInfo == 1 && window.posEnableCustomerSubline == 1) {
			var table = document.getElementById("takeAwayInfo");
			table.className = "borderBottom";
		}
	}
	
	if(window.posEnableDebug == 1)
		$('#errors').append("<p>Printing will start.</p>");

	if(checkIfNotZeroEmptyOrNull(completeReceipt.customer) && (checkIfNotZeroEmptyOrNull(completeReceipt.customer.firstname) || checkIfNotZeroEmptyOrNull(completeReceipt.customer.lastname)))
		window.posCustomerAvailable = 1;
	if(checkIfNotZeroEmptyOrNull(completeReceipt.company))
		window.posCompanyAvailable = 1;
	if(checkIfNotZeroEmptyOrNull(completeReceipt.receipt))
		window.posReceiptAvailable = 1;
	if(checkIfNotZeroEmptyOrNull(completeReceipt.template))
		window.posTemplateAvailable = 1;
	if(checkIfNotZeroEmptyOrNull(completeReceipt.user))
		window.posUserAvailable = 1;
	if(checkIfNotZeroEmptyOrNull(completeReceipt.table))
		window.posTableAvailable = 1;
	if(checkIfNotZeroEmptyOrNull(completeReceipt.vat))
		window.posVatAvailable = 1;
	if(checkIfNotZeroEmptyOrNull(completeReceipt.barItems))
		window.posBarItemsAvailable = 1;
	if(checkIfNotZeroEmptyOrNull(completeReceipt.kitchenItems))
		window.posKitchenItemsAvailable = 1;
	if(checkIfNotZeroEmptyOrNull(completeReceipt.payments))
		window.posPaymentsAvailable = 1;
	if(checkIfNotZeroEmptyOrNull(completeReceipt.productCategories))
		window.posProductCategoriesAvailable = 1;
	if(checkIfNotZeroEmptyOrNull(completeReceipt.additionValues))
		window.posAdditionValuesAvailable = 1;

		/* Header */
		$( "#headerTemplate" ).tmpl(completeReceipt).appendTo("#header");
		
		if(window.posEnableDebug == 1)
			$('#errors').append("<p>Header printed.</p>");

		/* Receipt items */
		//$( "#receiptItemsTemplate" ).tmpl( receiptItemsArray ).appendTo( "#receiptItemsList" );
		addReceiptItemsAmountToAdditions(completeReceipt.receipt.receiptItems);
		if(window.posEnableCombineItems == 1) {
			if(checkIfNotZeroEmptyOrNull(completeReceipt.receipt.actionReceiptItems)) {
				var items = new Array();
				for(var key in completeReceipt.receipt.receiptItems) {
					if(completeReceipt.receipt.receiptItems.hasOwnProperty(key))
						items.push(completeReceipt.receipt.receiptItems[key]);
				}
				for(var key in completeReceipt.receipt.actionReceiptItems) {
					if(completeReceipt.receipt.actionReceiptItems.hasOwnProperty(key))
						items.push(completeReceipt.receipt.actionReceiptItems[key]);
				}
				//completeReceipt.receipt.receiptItems = combineItems(items);
				completeReceipt.receipt.receiptItems = combineMenusAndItems(flattenReceiptItemsHierarchy(items));
			}
			else {
				completeReceipt.receipt.receiptItems = combineMenusAndItems(flattenReceiptItemsHierarchy(completeReceipt.receipt.receiptItems));
				//completeReceipt.receipt.receiptItems = combineItems(completeReceipt.receipt.receiptItems);
			}
			if(window.posShowMenuOnly == 1) {
				var indexToDelete = new Array();
				for(var key in completeReceipt.receipt.receiptItems)
					if(completeReceipt.receipt.receiptItems.hasOwnProperty(key)) {
						if(completeReceipt.receipt.receiptItems[key].parentRiReceiptId != 0)
							indexToDelete.push(key);
					}
				for(var i = indexToDelete.length - 1; i >= 0; i--)
					completeReceipt.receipt.receiptItems.splice(indexToDelete[i], 1);
			}
		}

		if (window.posEnableSortOnCourseThenOnKitchenName == 1) {
			var count = itemArray.length;

			for(var i = 0; i < itemArray.length; i++) {
				for (var key in completeReceipt.productCategories) {
					if(completeReceipt.productCategories.hasOwnProperty(key))
						for(var key2 in completeReceipt.productCategories[key].products)
							if(completeReceipt.productCategories[key].products.hasOwnProperty(key2))
								for(var j = 0; j < completeReceipt.productCategories[key].products[key2].displayNames.length; j++) {
									if(completeReceipt.productCategories[key].products[key2].displayNames[j] == itemArray[i].name)
											itemArray[i].order = completeReceipt.productCategories[key].printOrder;
								}
				}
			}

			cmp = function(x, y) {
		    	return x > y ? 1 : x < y ? -1 : 0; 
			};

			//var sortedArray = productArray.sort(dynamicSort("order"));
			var sorted2 = itemArray.sort(function(a, b){
		    //note the minus before -cmp, for descending order
		    	return cmp ( 
		        	[cmp(a.order, b.order), cmp(a.name, b.name)], 
		        	[cmp(b.order, a.order), cmp(b.name, a.name)]
		    	);
			});

			for(var key in sorted2) {
				if(sorted2.hasOwnProperty(key)) {
					if(key != 0) {
						if(sorted2[key].order > sorted2[key-1].order)
							sorted2[key].line = 1;
					}
				}
			}

			for(var j = 0; j < combinedMenuArray.length; j++)
				for(h = 0; h < combinedMenuArray[j][0].length; h++)
					sorted2.push(combinedMenuArray[j][0][h]);
		}
		else if(window.posOrderBy != "") {
			sortJsonArrayByProperty(itemArray, window.posOrderBy, window.posOrderDirection);
			var itemsArray = new Array();
			for(var j = 0; j < itemArray.length; j++)
				itemsArray.push(itemArray[j]);
			for(var j = 0; j < combinedMenuArray.length; j++)
				for(h = 0; h < combinedMenuArray[j][0].length; h++)
					itemsArray.push(combinedMenuArray[j][0][h]);
		}

		if(window.posEnableSortOnCourseThenOnKitchenName == 1)
			completeReceipt.receipt.receiptItems = sorted2;
		if(window.posEnableSortOnCourseThenOnKitchenName == 0 && window.posOrderBy != "")
			window.completeReceipt.receipt.receiptItems = completeReceipt.receipt.receiptItems;
		$( "#receiptItemsTemplate" ).tmpl( completeReceipt.receipt.receiptItems ).appendTo( "#receiptItemsList" );
		
		if(window.posEnableDebug == 1)
			$('#errors').append("<p>Receipt items have been printed.</p>");

		/* (Sub)total */
		var discount = calculateDiscount(completeReceipt.receipt);
		var service = calculateServiceCharge(completeReceipt.receipt);

		if(discount != 0)
			$("#discountsTemplate").tmpl().appendTo("#discounts");

		if(window.posEnableDebug == 1)
			$('#errors').append("<p>Discounts have been printed.</p>");

		if(checkIfNotZeroEmptyOrNull(completeReceipt.receipt.actionReceiptItems))
			$("#gratuityTemplate").tmpl(completeReceipt.receipt.actionReceiptItems).appendTo("#gratuity");

		if(window.posEnableDebug == 1)
			$('#errors').append("<p>Gratuity has been printed.</p>");

		if(calculateTip(completeReceipt.payments) > 0)
			$("#totalTipTemplate").tmpl(completeReceipt).appendTo("#totalTip");

		if(window.posEnableDebug == 1)
			$('#errors').append("<p>Tip has been printed.</p>");

		if(completeReceipt.template.showTotalPrice == 1) {
			if(discount != 0 || service != 0)
				$("#subtotalsTemplate").tmpl(completeReceipt.receipt).appendTo("#subtotals");		
			$("#receiptTotals").tmpl(completeReceipt).appendTo("#totals");
		}

		if(window.posEnableDebug == 1)
			$('#errors').append("<p>Receipt totals have been printed.</p>");

		/* Payments */
		if(checkIfNotZeroEmptyOrNull(completeReceipt.payments)) {
			$("#paymentTypeTemplate").tmpl(completeReceipt.payments).appendTo("#paymentsTable");
			$("#totalAmountTemplate").tmpl(completeReceipt).appendTo("#totalAmount");
			$( "#changeTemplate" ).tmpl( completeReceipt ).appendTo( "#change" );
		}
		else
			$("#paymentsTable").remove();

		if(window.posEnableDebug == 1)
			$('#errors').append("<p>Payments, change have been printed.</p>");

		/* VAT */
		var vatArray = new Array();
					
		for(var key in completeReceipt.vat)
			if(completeReceipt.vat.hasOwnProperty(key))
				if(completeReceipt.vat[key] != 0)
					vatArray.push({vat:key,price:completeReceipt.vat[key]});

		vatArray.sort();		
		completeReceipt.vat = vatArray;
				
		if(completeReceipt.template.showVat == 1)
			$("#vatTemplate").tmpl(completeReceipt.vat).appendTo("#vat");
		else
			$("#vat").hide();

		if(window.posEnableDebug == 1)
			$('#errors').append("<p>VAT has been printed.</p>");

		/* Thank you */
		$("#thankYouTemplate").tmpl(completeReceipt.template).appendTo("#thankYou");

		/* Promotion */
		$("#promotionTemplate").tmpl(completeReceipt.template).appendTo("#promotion");
	
	if(completeReceipt.template.showCompanyInfo==1){
		$( "#footerTemplate" ).tmpl(completeReceipt).appendTo("#footer");
	}
	
	if(window.posEnableDebug == 1)
		$('#errors').append("<p>Company info has been printed.</p>");
	
	if(completeReceipt.receipt.url && completeReceipt.receipt.url !== undefined && completeReceipt.receipt.url !== null && completeReceipt.receipt.url !== ""){
		$('#restaurantInfo').qrcode({width: 150,height: 150,text: completeReceipt.receipt.url});
	}
	
	if(document.getElementsByTagName('canvas')[0]) {
		var canvas = document.getElementsByTagName('canvas')[0];
		canvas.className = "floatRight";
		canvas.id = "qrCode";
		var theDiv = document.getElementById("restaurantInfo");
		theDiv.appendChild(canvas);
	}

	if(completeReceipt.payments.length != 0) {
		var payments = checkPaymentOptionalInfoPresent(completeReceipt.payments);
		if(payments != null)
			for(var i = 0; i < payments.length; i++) {
				var paymentInformation = new Object();
				var cardInformation = payments[i].optionalInfo.split(";");
				paymentInformation.cardHolder = cardInformation[1];
				paymentInformation.cardNumber = cardInformation[0].substring(cardInformation[0].length, 4);
				$("#signatureTemplate").tmpl(paymentInformation).appendTo("#signature");
			}
	}
			
	jQuery("[i21D='defaultFontSize']").each(function(i,e){
	 //console.log($(e));
	 $(e).css({"font-family":completeReceipt.template.fontName});
	 $(e).css({"font-size":completeReceipt.template.fontSize});
	});
   
	jQuery("[i21B='bigFontSize']").each(function(i,e){
	 //console.log($(e));
	 $(e).css({"font-family":completeReceipt.template.bigFontName});
	 $(e).css({"font-size":completeReceipt.template.bigFontSize});
	}); 
	
	jQuery("[i21S='smallFontSize']").each(function(i,e){
	 //console.log($(e));
	 $(e).css({"font-family":completeReceipt.template.smallFontName});
	 $(e).css({"font-size":completeReceipt.template.smallFontSize});
	});  
	if(window.posEnableSortOnCourseThenOnKitchenName == 1 && window.posEnableCourseLines == 1)
    	checkLine();
	if(window.posShowPrice == 0) {
		$('#priceHide').remove();    
		$(".name").css("width", "100%");
	}
}		
</script>
</head>
<body style="background:#fff">
	<div id="errors"></div>
	<div id="header" i21D='defaultFontSize'></div>
    <table id="receiptItemsList" i21D='defaultFontSize'>
        <tr>
        	<th style="display:none;"></th>
            <th id="amountItems" align="left">#</th>
            <th id="productItem" align="left">Naam</th>
            <th id="priceHide" align="right">Prijs</th>
        </tr>
    </table>
	<table id="subtotals" i21D='defaultFontSize'>
	</table>
	<table id="discounts" i21D='defaultFontSize'>
	</table>
	<table id="gratuity" i21D='defaultFontSize'>
	</table>
	<table id="totalTip" i21D='defaultFontSize'>
	</table>   
	<table id="totals" i21D='defaultFontSize'>
	</table>  
	<table id="paymentsTable" i21D='defaultFontSize'>
		<tr>
			<th align="left">Betaling</th>
			<th align="right">Bedrag</th>
		</tr>  
  	</table>
  	<table id="totalAmount" i21D='defaultFontSize'>
  	</table>
  	<table id="change" i21D='defaultFontSize'>  
    </table>    
    <table id="vat" i21D='defaultFontSize'>
        <tr>
        	<th></th>
            <th class="alignRight">Netto</th>
            <th class="alignRight">BTW</th>
            <th class="floatRight">Totaal</th>
       </tr>
    </table>
    <div id="thankYou" i21B='bigFontSize'>
    </div>
    <div id="promotion" i21D='defaultFontSize' style="display:inline-block">
    </div>
  	<div id="signature" i21D='defaultFontSize'>
  	</div>  
    <div id="footer">
    </div>
</body>
</html>